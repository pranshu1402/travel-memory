---
# Main Monitoring Playbook
# Orchestrates Prometheus, MongoDB Exporter, and Grafana setup

- name: Monitoring Infrastructure Setup
  hosts: all
  become: yes
  gather_facts: yes

  tasks:
    - name: Display monitoring setup information
      debug:
        msg: "Starting monitoring infrastructure setup for {{ inventory_hostname }}"

# MongoDB Exporter on DB Server
- import_playbook: mongodb-exporter.yml

# Prometheus and Grafana on Web Server
- import_playbook: prometheus.yml
- import_playbook: grafana.yml

- name: Monitoring Setup Complete
  hosts: web_servers
  become: yes

  tasks:
    - name: Display completion message
      debug:
        msg: "Monitoring infrastructure setup completed successfully!"

    - name: Show monitoring services information
      debug:
        msg: |
          Prometheus: http://{{ ansible_default_ipv4.address }}:9090
          Grafana: http://{{ ansible_default_ipv4.address }}:3000
          Backend Metrics: http://{{ ansible_default_ipv4.address }}:3001/metrics

